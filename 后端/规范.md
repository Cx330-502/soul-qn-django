# 后端规范说明

## app说明

user_about 登录注册 组织

mainpage 主页面 查询问卷

edit_qn 编辑问卷

analyse_qn 分析问卷

answer_qn 回答问卷

Qn 模型存储 (所有表都存在Qn.models下)

## 表说明

### 一览

1. 用户(**id**，用户名，密码，邮箱)

2. 组织(**id**，组织名)

3. 问卷(**id**，问卷名，种类，收集数量，状态，发布时间，截止时间，限时开始，作答时间，问卷密码，标题，说明)

4. 组织2用户(*组织id*，*用户id*，状态)
5. 用户2创建问卷(*用户id*，*问卷id*)
6. 组织2创建问卷(*组织id*，*问卷id*，是否必答)
7. 题目(**id**，类型，描述，*问卷id*，是否必答，题面，宽度，顺序，是否换行，分数)

8. 选择题(***题目id***，内容(选项)，种类，答案)
9. 文本题(***题目id***，内容，种类，答案)
10. ~~文件(***题目id***，文件类型)~~
11. ~~定位(***题目id***，待定)~~
12. ~~视频(***题目id***，待定)~~
13. ~~图片(***题目id***，待定)~~
14. 回答(**回答id**，*问卷id*，*答卷者id*，回答时间(提交时间)，用时，分数，状态)
15. 答案(*回答id*，*题号id*，答案，答案2，答案3，答案4，答案5，得分)

### 细览

#### 1. 用户：User

1. **id**

2. 用户名：username

   ```python
   CharField("用户名", max_length=100)
   ```

3. 密码：password

   ```python
   CharField("密码", max_length=20)
   ```

4. 邮箱：email

   ```python
   EmailField("邮箱")
   ```

#### 2. 组织：Organization

1. **id**

2. 组织名：name

   ```python
   CharField("组织名", max_length=100)
   ```

#### 3. 问卷：Questionnaire

1. **id**

2. 问卷名：name

   ```python
   CharField("问卷名", max_length=100)
   ```

3. 种类：type

   ```python
   models.IntegerField("问卷类型")  #
   ```

4. 收集数量：collection_num

   ```python
   IntegerField("问卷收集人数")
   ```

5. 状态：state

   ```python
   IntegerField("问卷状态")
   # 0表示审核中,1表示已发布,-1表示发布失败,2表示尚未开始,-2表示已结束
   ```

6. 发布时间：release_time

   ```python
   DateTimeField("问卷发布时间")
   ```

7. 截止时间：finish_time

   ```python
   DateTimeField("问卷截止时间")
   ```

8. 限时开始：start_time

   ```python
   DateTimeField("问卷开始时间")
   ```

9. 作答时间：duration

   ```python
   IntegerField("问卷持续时间")  # 单位为秒
   ```

10. 问卷密码：password

    ```python
    CharField("问卷密码", max_length=20)
    ```

11. 标题：title

    ```python
    CharField("问卷标题", max_length=100)
    ```

12. 说明：description

    ```python
    CharField("问卷描述", max_length=100)
    ```

#### 4. 组织2用户：Organization_2_User

1. *组织id*：organization_id

   ```python
   ForeignKey(Organization, on_delete=models.CASCADE)
   ```

2. *用户id*：user_id

   ```python
   ForeignKey(User, on_delete=models.CASCADE)
   ```

3. 状态：state

   ```python
   IntegerField("用户在组织中的状态")  
   # 0表示审核中,1表示已通过,-1表示拒绝,2表示可发布一次问卷,3表示可发布多次问卷,4表示可审核且可发布多次问卷
   ```

#### 5. 用户2创建问卷：User_create_Questionnaire

1. *用户id*：user_id

   ```python
   ForeignKey(User, on_delete=models.CASCADE)
   ```

2. *问卷id*：questionnaire_id

   ```python
   ForeignKey(Questionnaire, on_delete=models.CASCADE)
   ```

#### 6. 组织2创建问卷：Organization_create_Questionnaire

1. *组织id*：organization_id

   ```python
   ForeignKey(Organization, on_delete=models.CASCADE)
   ```

2. *问卷id*：questionnaire_id

   ```python
   ForeignKey(Questionnaire, on_delete=models.CASCADE)
   ```

3. 是否必答：necessary

   ```python
   BooleanField("问卷是否必填")  # True表示必填,False表示非必填
   ```

#### 7. 题目：Question

1. **id**

2. 类型：type

   ```python
   IntegerField("问题类型")  # 0表示选择,1表示文本
   ```

3. 描述：description

   ```python
   CharField("问题描述", max_length=200)
   ```

4. *问卷id*：questionnaire_id

   ```python
   ForeignKey(Questionnaire, on_delete=models.CASCADE)
   ```

5. 是否必答：necessary

   ```python
   BooleanField("问题是否必答")  # True表示必答,False表示非必答
   ```

6. 题面：surface

   ```python
   CharField("问题表面", max_length=200)
   ```

7. 宽度：width

   ```python
   IntegerField("问题宽度")
   ```

8. 顺序：order

   ```python
   IntegerField("问题顺序")
   ```

9. 是否换行：change_line

   ```python
   IntegerField("问题是否换行")  # 0表示不换行,1表示换行
   ```

10. 分数：score

    ```python
    IntegerField("问题分数")
    ```

#### 8. 选择题：Choices

1. ***题目id***：question_id

   ```python
   ForeignKey(Question, on_delete=models.CASCADE, primary_key=True)
   ```

2. 内容(选项)：content

   ```python
   CharField("选项内容", max_length=400)
   ```

3. 种类：type

   ```python
   IntegerField("选项类型")  # 0表示单选,1表示多选
   ```

4. 答案：answer

   ```python
   CharField("选项答案", max_length=200)  # 以 "===" 分割
   ```

#### 9. 文本题：Textes

1. ***题目id***：question_id

   ```python
   ForeignKey(Question, on_delete=models.CASCADE, primary_key=True)
   ```

2. 内容：content

   ```python
   TextField("文本内容")
   ```

3. 种类：type

   ```python
   IntegerField("选项类型")
   ```

4. 答案：answer

   ```python
   TextField("文本答案")
   ```

#### ~~10. 文件~~

~~(***题目id***，文件类型)~~

#### ~~11. 定位~~

~~(***题目id***，待定)~~

#### ~~12. 视频~~

~~(***题目id***，待定)~~

#### ~~13. 图片~~

~~(***题目id***，待定)~~

#### 14. 答卷：Answer_sheet

1. **id**

2. *问卷id*：questionnaire_id

   ```python
   ForeignKey(Questionnaire, on_delete=models.CASCADE)
   ```

3. *答卷者id*：answerer_id

   ```python
   ForeignKey(User, on_delete=models.CASCADE)
   ```

4. 回答时间(提交时间)：submit_time

   ```python
   DateTimeField("问卷提交时间")
   ```

5. 用时：duration

   ```python
   IntegerField("问卷持续时间")  # 单位为秒
   ```

6. 分数：score

   ```python
   IntegerField("问卷分数")
   ```

7. 状态：state

   ```python
   IntegerField("问卷状态")  # 0表示未完成,1表示已完成,-1表示未提交
   ```

#### 15. 题目回答：Exercise_answer

1. *答卷id*：answer_sheet_id

   ```python
   ForeignKey(Answer_sheet, on_delete=models.CASCADE)
   ```

2. *题号id*：question_id

   ```python
   ForeignKey(Question, on_delete=models.CASCADE)
   ```

3. 答案：answer

   ```python
   CharField("回答", max_length=200)
   ```

4. 答案2：answer2

   ```python
   TextField("回答2")
   ```

5. 答案3：answer3

   ```python
   IntegerField("回答3")
   ```

6. 答案4：answer4

   ```python
   ImageField("回答4")
   ```

7. 答案5：answer5

   ```python
   FileField("回答5")
   ```

8. 得分：score

   ```python
   IntegerField("回答得分")
   ```

## 功能说明(后端)

### 登陆界面

1. 注册（邮箱发送验证码）
2. 登录

### 组织界面

1. 列出所在组织
2. 列出组织内联系人
3. 邀请：
   1. 通过链接
   2. 通过email搜索
   3. 通过username搜索
4. 组织管理：
   1. 通过加入申请
   2. 踢人
   3. 赋予权限
5. 搜索（前端或后端）

### 主界面（工作台）

1. 左侧菜单：

   1. 新建（前端）

   2. 列出个人发布问卷

   3. 列出组织列表

   4. 列出团体发布问卷

   5. 列出回答的问卷

   6. 列出回收站内的问卷

2. 右侧main主体：

   1. 编辑（列出问卷内容）
   2. 删除
   3. 搜索
   4. 排序
   5. 预览
   6. 复制
   7. 开启
   8. 关闭
   9. 导出
   10. 分享
   11. 统计

### 新建

1. 加载模板

### 编辑

1. 退出时提示保存
2. 若是编辑则需要加载之前的问卷

### 回答问卷

1. 退出时状态保存

### 分析问卷

1. 回收时间的图表
2. 具体每一份的预览、回答（判分分析）
3. 每题的统计
4. others
